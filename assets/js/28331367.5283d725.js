(self.webpackChunkhhow_09_github_io=self.webpackChunkhhow_09_github_io||[]).push([[2704],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return p},kt:function(){return d}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=c(n),d=i,h=m["".concat(l,".").concat(d)]||m[d]||u[d]||r;return n?a.createElement(h,o(o({ref:t},p),{},{components:n})):a.createElement(h,o({ref:t},p))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var c=2;c<r;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9999:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return s},metadata:function(){return l},toc:function(){return c},default:function(){return u}});var a=n(2122),i=n(9756),r=(n(7294),n(3905)),o=["components"],s={},l={unversionedId:"system/cap",id:"system/cap",isDocsHomePage:!1,title:"C.A.P Theorem",description:"Intro",source:"@site/docs/system/1-cap.md",sourceDirName:"system",slug:"/system/cap",permalink:"/system/cap",editUrl:"https://github.com/hhow09/hhow09.github.io/blob/source/docs/system/1-cap.md",version:"current",sidebarPosition:1,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Performance Optimization of React",permalink:"/react/react-performance-optimization"},next:{title:"Distributed Cache",permalink:"/system/distributed-cache"}},c=[{value:"Intro",id:"intro",children:[]},{value:"Consistency Models",id:"consistency-models",children:[{value:"Taxonomy of consistency model.",id:"taxonomy-of-consistency-model",children:[]},{value:"Trade Offs",id:"trade-offs",children:[]},{value:"Linearizability (<code>C</code> &gt; <code>A</code>)",id:"linearizability-c--a",children:[]},{value:"Sequential Consistency",id:"sequential-consistency",children:[]},{value:"Causal Consistency",id:"causal-consistency",children:[]},{value:"Eventual consistency (<code>A</code> &gt; <code>C</code>)",id:"eventual-consistency-a--c",children:[]}]},{value:"CP/AP: a false dichotomy",id:"cpap-a-false-dichotomy",children:[]},{value:"Reference",id:"reference",children:[]}],p={toc:c};function u(e){var t=e.components,s=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},p,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"intro"},"Intro"),(0,r.kt)("p",null,"The ",(0,r.kt)("strong",{parentName:"p"},"CAP Theorem")," says that it is impossible to build an implementation of read-write storage in an asynchronous network that satisfies all of the following three properties:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Availability"),": will a request made to the data store always eventually complete?"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Consistency"),": will all executions of reads and writes seen by all nodes be atomic/linearizably consistent?"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Partition tolerance"),": the network is allowed to drop any messages.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"A ",(0,r.kt)("strong",{parentName:"li"},"partition")," is a communications break within a distributed system\u2014a lost or temporarily delayed connection between two nodes.")))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"consistency-models"},"Consistency Models"),(0,r.kt)("p",null,"Consistency Model is contract between a distributed data system (e.g., ",(0,r.kt)("inlineCode",{parentName:"p"},"DFS"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"DSM"),") and\nprocesses constituting its applications"),(0,r.kt)("h3",{id:"taxonomy-of-consistency-model"},"Taxonomy of consistency model."),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(3794).Z})),(0,r.kt)("h3",{id:"trade-offs"},"Trade Offs"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\u2191 Consistent, Complex \u2191")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Linearizability"),(0,r.kt)("li",{parentName:"ul"},"Sequential consistency"),(0,r.kt)("li",{parentName:"ul"},"Causal consistency"),(0,r.kt)("li",{parentName:"ul"},"Eventual consistency")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\u2193 Available, Low Latency, Feasible, Scalable \u2193")),(0,r.kt)("h3",{id:"linearizability-c--a"},"Linearizability (",(0,r.kt)("inlineCode",{parentName:"h3"},"C")," > ",(0,r.kt)("inlineCode",{parentName:"h3"},"A"),")"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Should provide the behavior of a ",(0,r.kt)("strong",{parentName:"li"},"single copy")),(0,r.kt)("li",{parentName:"ul"},"The ordering of operations is determined ",(0,r.kt)("strong",{parentName:"li"},"by time"),"."),(0,r.kt)("li",{parentName:"ul"},"A read operation returns the most recent write, regardless of the clients."),(0,r.kt)("li",{parentName:"ul"},"All subsequent read ops should return the same result until the next write, regardless of the clients."),(0,r.kt)("li",{parentName:"ul"},"Cons: implementation requires absolute global time")),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(3446).Z})),(0,r.kt)("h4",{id:"what-happens-if-you-dont-have-linearizability"},"What happens if you don't have Linearizability?"),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(8770).Z})),(0,r.kt)("h3",{id:"sequential-consistency"},"Sequential Consistency"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Should provide the behavior of a ",(0,r.kt)("strong",{parentName:"p"},"single copy"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The ordering of operations is ",(0,r.kt)("strong",{parentName:"p"},"determined by the program order of each client"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Reads may be stale in terms of real time, but not in logical time.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"A read operation returns the most recent write, regardless of the clients.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Writes are totally ordered according to logical time across all replicas")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Cons: requires highly available connections"))),(0,r.kt)("h3",{id:"causal-consistency"},"Causal Consistency"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Writes that are potentially causally related must be seen by all machines in same order."),(0,r.kt)("li",{parentName:"ul"},"Concurrent writes may be seen in a different order on different machines.")),(0,r.kt)("h3",{id:"eventual-consistency-a--c"},"Eventual consistency (",(0,r.kt)("inlineCode",{parentName:"h3"},"A")," > ",(0,r.kt)("inlineCode",{parentName:"h3"},"C"),")"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Is: Allow stale reads, but ensure that reads will eventually reflect previously written values.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Doesn\u2019t order concurrent writes as they are executed, which might create conflicts later: ",(0,r.kt)("strong",{parentName:"p"},"which write was first?"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Pros: High data availability (",(0,r.kt)("inlineCode",{parentName:"p"},"A"),")")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Pros: High concurrency opportunities")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Pros: Support ",(0,r.kt)("strong",{parentName:"p"},"disconnected operations")," or ",(0,r.kt)("strong",{parentName:"p"},"network partitions")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Better to read a stale value than nothing"),(0,r.kt)("li",{parentName:"ul"},"Better to save writes somewhere than nothing"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Cons: may displaying stale data")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Cons: may violate Atomic Consistency")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"NoSQL databases that manage non-structured data are often good choices for ",(0,r.kt)("strong",{parentName:"p"},"eventual consistency models"),"."))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"cpap-a-false-dichotomy"},"CP/AP: a false dichotomy"),(0,r.kt)("p",null,"The fact that we haven\u2019t been able to classify even one datastore as unambiguously ",(0,r.kt)("inlineCode",{parentName:"p"},"AP")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"CP")," should be telling us something: those are simply not the right labels to describe systems."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Within one piece of software, you may well have various operations with ",(0,r.kt)("strong",{parentName:"p"},"different consistency characteristics"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Many systems are neither consistent nor available under the CAP theorem\u2019s definitions. However, I\u2019ve never heard anyone call their system just \u201cP\u201d, presumably because it looks bad. But it\u2019s not bad \u2013 it may be a perfectly reasonable design, it just doesn\u2019t fit one of the two ",(0,r.kt)("inlineCode",{parentName:"p"},"CP"),"/",(0,r.kt)("inlineCode",{parentName:"p"},"AP")," buckets.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Even though most software doesn\u2019t neatly fit one of those two buckets, people try to shoehorn software into one of the two buckets anyway, thereby inevitably changing the meaning of ",(0,r.kt)("inlineCode",{parentName:"p"},"consistency")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"availability")," to whatever definition suits them. Unfortunately, if the meaning of the words is changed, the CAP theorem no longer applies, and thus the ",(0,r.kt)("inlineCode",{parentName:"p"},"CP"),"/",(0,r.kt)("inlineCode",{parentName:"p"},"AP")," distinction is rendered completely meaningless.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"A huge amount of subtlety is lost by putting a system in one of two buckets. There are many considerations of fault-tolerance, latency, simplicity of programming model, operability, etc. that feed into the design of a distributed systems. It is simply not possible to encode this subtlety in one bit of information. For example, even though ZooKeeper has an ",(0,r.kt)("inlineCode",{parentName:"p"},"AP")," read-only mode, this mode still provides a total ordering of historical writes, which is a vastly stronger guarantee than the ",(0,r.kt)("inlineCode",{parentName:"p"},"AP")," in a system like ",(0,r.kt)("inlineCode",{parentName:"p"},"Riak")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"Cassandra")," \u2013 so it\u2019s ridiculous to throw them into the same bucket.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Even ",(0,r.kt)("a",{parentName:"p",href:"http://cs609.cs.ua.edu/CAP12.pdf"},"Eric Brewer admits that CAP is misleading and oversimplified"),". In 2000, it was meant to start a discussion about trade-offs in distributed data systems, and it did that very well. It wasn\u2019t intended to be a breakthrough formal result, nor was it meant to be a rigorous classification scheme for data systems. 15 years later, we now have a much greater range of tools with different consistency and fault-tolerance models to choose from. CAP has served its purpose, and now it\u2019s time to move on."))),(0,r.kt)("h2",{id:"reference"},"Reference"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/henryr/cap-faq"},"The CAP FAQ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://medium.com/%E5%BE%8C%E7%AB%AF%E6%96%B0%E6%89%8B%E6%9D%91/cap%E5%AE%9A%E7%90%86101-3fdd10e0b9a"},"CAP \u5b9a\u7406 101\u2014\u5206\u6563\u5f0f\u7cfb\u7d71\uff0c\u6709\u4e00\u597d\u6c92\u5169\u597d")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://martin.kleppmann.com/2015/05/11/please-stop-calling-databases-cp-or-ap.html"},"Please stop calling databases CP or AP")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.researchgate.net/publication/331104869_Consistency_models_of_NoSQL_databases#pf12"},"Consistency models of NoSQL databases")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://cse.buffalo.edu/~stevko/courses/cse486/spring13/lectures/26-consistency2.pdf"},"CSE 486/586 Distributed Systems Consistency --- 2")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.cs.columbia.edu/~du/ds/assets/lectures/lecture12.pdf"},"Lec 12: Consistency Models \u2013 Sequential, Causal, and Eventual Consistency"))))}u.isMDXComponent=!0},3446:function(e,t,n){"use strict";t.Z=n.p+"assets/images/linearizability-dfb4235c358061b2b4e780fb66f6859b.png"},8770:function(e,t,n){"use strict";t.Z=n.p+"assets/images/not-linearizability-b8ee3dc6356a720b08f1717df88f0eda.png"},3794:function(e,t,n){"use strict";t.Z=n.p+"assets/images/taxonomy-of-consistency-model-7f007ac4a2c4bcce179e35e36e9d3924.png"}}]);