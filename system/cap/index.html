<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Modern Tragedy Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Modern Tragedy Blog Atom Feed"><title data-react-helmet="true">C.A.P Theorem | Modern Tragedy</title><meta data-react-helmet="true" property="og:url" content="https://hhow09.github.io//system/cap"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="C.A.P Theorem | Modern Tragedy"><meta data-react-helmet="true" name="description" content="Intro"><meta data-react-helmet="true" property="og:description" content="Intro"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://hhow09.github.io//system/cap"><link data-react-helmet="true" rel="alternate" href="https://hhow09.github.io//system/cap" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://hhow09.github.io//system/cap" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.cb17f33c.css">
<link rel="preload" href="/assets/js/runtime~main.2339bfd3.js" as="script">
<link rel="preload" href="/assets/js/main.fb688673.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Modern Tragedy</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hhow09" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Modern Tragedy</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/hhow09" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/">Index</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Algorithm</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/algorithm/union-find">Union Find</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Data Structure</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/data-structure/index">Index</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/data-structure/skip-list">Skip List</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/data-structure/b-tree">B-Tree</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Frontend Testing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fe-test/index">Frontend Test</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fe-test/jest-test-with-mock-functions">Jest: Test with Mock Functions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Javascript</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/js/js-closure">Closure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/js/js-immutability">Immutability</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/js/js-dev-note">Javascript Dev Notes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/js/js-fp">Functional Programming</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Programming</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/programming/clean-code-note">Clean Code - Object Oriented Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/programming/concurrent-vs-parallelism">Concurrency vs. Parallelism v.s. Coroutine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/programming/encode-hash-encryption">Encode, Hash and Encryption</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">React</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/react/react-prop-drilling">Props Drilling and State Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/react/react-compund-component">Compound Component</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/react/react-parent-child-pass-value">3 Ways To Pass Values From Child to Parent</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/react/react-dev-detail">React Dev Notes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/react/react-custom-hook">Design React Custom Hook</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/react/react-interview-questions">React Interview Questions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/react/redux-flux">Redux and Flux</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/react/react-performance-optimization">Performance Optimization of React</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/react/react-vs-vue">React v.s. Vue</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">System Design</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/system/cap">C.A.P Theorem</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/system/distributed-cache">Distributed Cache</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Web Dev</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/web-dev/web-lighthouse-performance">Lighthouse Performance</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/web-dev/web-browser-navigation-flow">Browser Navigation Flow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/web-dev/web-browser-event-loop">Event Loop</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/web-dev/web-js-engine-introduction">JS engine: Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/web-dev/web-js-engine-object-optimization">JS engine: Optimizing of Object</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/web-dev/web-auth">Web Authentication</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Web Fundamentals</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/web-fundamental/http-methods">HTTP Methods</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/web-fundamental/web-cors">CORS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/web-fundamental/web-cache-control">Cache Control</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/web-fundamental/web-security">Web Security</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">C.A.P Theorem</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="intro"></a>Intro<a class="hash-link" href="#intro" title="Direct link to heading">#</a></h2><p>The <strong>CAP Theorem</strong> says that it is impossible to build an implementation of read-write storage in an asynchronous network that satisfies all of the following three properties:</p><ul><li><strong>Availability</strong>: will a request made to the data store always eventually complete?</li><li><strong>Consistency</strong>: will all executions of reads and writes seen by all nodes be atomic/linearizably consistent?</li><li><strong>Partition tolerance</strong>: the network is allowed to drop any messages.<ul><li>A <strong>partition</strong> is a communications break within a distributed system—a lost or temporarily delayed connection between two nodes.</li></ul></li></ul><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="consistency-models"></a>Consistency Models<a class="hash-link" href="#consistency-models" title="Direct link to heading">#</a></h2><p>Consistency Model is contract between a distributed data system (e.g., <code>DFS</code>, <code>DSM</code>) and
processes constituting its applications</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="taxonomy-of-consistency-model"></a>Taxonomy of consistency model.<a class="hash-link" href="#taxonomy-of-consistency-model" title="Direct link to heading">#</a></h3><p><img src="/assets/images/taxonomy-of-consistency-model-7f007ac4a2c4bcce179e35e36e9d3924.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="trade-offs"></a>Trade Offs<a class="hash-link" href="#trade-offs" title="Direct link to heading">#</a></h3><p><code>↑ Consistent, Complex ↑</code></p><ul><li>Linearizability</li><li>Sequential consistency</li><li>Causal consistency</li><li>Eventual consistency</li></ul><p><code>↓ Available, Low Latency, Feasible, Scalable ↓</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="linearizability-c--a"></a>Linearizability (<code>C</code> &gt; <code>A</code>)<a class="hash-link" href="#linearizability-c--a" title="Direct link to heading">#</a></h3><ul><li>Should provide the behavior of a <strong>single copy</strong></li><li>The ordering of operations is determined <strong>by time</strong>.</li><li>A read operation returns the most recent write, regardless of the clients.</li><li>All subsequent read ops should return the same result until the next write, regardless of the clients.</li><li>Cons: implementation requires absolute global time</li></ul><p><img src="/assets/images/linearizability-dfb4235c358061b2b4e780fb66f6859b.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="what-happens-if-you-dont-have-linearizability"></a>What happens if you don&#x27;t have Linearizability?<a class="hash-link" href="#what-happens-if-you-dont-have-linearizability" title="Direct link to heading">#</a></h4><p><img src="/assets/images/not-linearizability-b8ee3dc6356a720b08f1717df88f0eda.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="sequential-consistency"></a>Sequential Consistency<a class="hash-link" href="#sequential-consistency" title="Direct link to heading">#</a></h3><ul><li><p>Should provide the behavior of a <strong>single copy</strong>.</p></li><li><p>The ordering of operations is <strong>determined by the program order of each client</strong>.</p></li><li><p>Reads may be stale in terms of real time, but not in logical time.</p></li><li><p>A read operation returns the most recent write, regardless of the clients.</p></li><li><p>Writes are totally ordered according to logical time across all replicas</p></li><li><p>Cons: requires highly available connections</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="causal-consistency"></a>Causal Consistency<a class="hash-link" href="#causal-consistency" title="Direct link to heading">#</a></h3><ul><li>Writes that are potentially causally related must be seen by all machines in same order.</li><li>Concurrent writes may be seen in a different order on different machines.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="eventual-consistency-a--c"></a>Eventual consistency (<code>A</code> &gt; <code>C</code>)<a class="hash-link" href="#eventual-consistency-a--c" title="Direct link to heading">#</a></h3><ul><li><p>Is: Allow stale reads, but ensure that reads will eventually reflect previously written values.</p></li><li><p>Doesn’t order concurrent writes as they are executed, which might create conflicts later: <strong>which write was first?</strong></p></li><li><p>Pros: High data availability (<code>A</code>)</p></li><li><p>Pros: High concurrency opportunities</p></li><li><p>Pros: Support <strong>disconnected operations</strong> or <strong>network partitions</strong></p><ul><li>Better to read a stale value than nothing</li><li>Better to save writes somewhere than nothing</li></ul></li><li><p>Cons: may displaying stale data</p></li><li><p>Cons: may violate Atomic Consistency</p></li><li><p>NoSQL databases that manage non-structured data are often good choices for <strong>eventual consistency models</strong>.</p></li></ul><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cpap-a-false-dichotomy"></a>CP/AP: a false dichotomy<a class="hash-link" href="#cpap-a-false-dichotomy" title="Direct link to heading">#</a></h2><p>The fact that we haven’t been able to classify even one datastore as unambiguously <code>AP</code> or <code>CP</code> should be telling us something: those are simply not the right labels to describe systems.</p><ul><li><p>Within one piece of software, you may well have various operations with <strong>different consistency characteristics</strong>.</p></li><li><p>Many systems are neither consistent nor available under the CAP theorem’s definitions. However, I’ve never heard anyone call their system just “P”, presumably because it looks bad. But it’s not bad – it may be a perfectly reasonable design, it just doesn’t fit one of the two <code>CP</code>/<code>AP</code> buckets.</p></li><li><p>Even though most software doesn’t neatly fit one of those two buckets, people try to shoehorn software into one of the two buckets anyway, thereby inevitably changing the meaning of <code>consistency</code> or <code>availability</code> to whatever definition suits them. Unfortunately, if the meaning of the words is changed, the CAP theorem no longer applies, and thus the <code>CP</code>/<code>AP</code> distinction is rendered completely meaningless.</p></li><li><p>A huge amount of subtlety is lost by putting a system in one of two buckets. There are many considerations of fault-tolerance, latency, simplicity of programming model, operability, etc. that feed into the design of a distributed systems. It is simply not possible to encode this subtlety in one bit of information. For example, even though ZooKeeper has an <code>AP</code> read-only mode, this mode still provides a total ordering of historical writes, which is a vastly stronger guarantee than the <code>AP</code> in a system like <code>Riak</code> or <code>Cassandra</code> – so it’s ridiculous to throw them into the same bucket.</p></li><li><p>Even <a href="http://cs609.cs.ua.edu/CAP12.pdf" target="_blank" rel="noopener noreferrer">Eric Brewer admits that CAP is misleading and oversimplified</a>. In 2000, it was meant to start a discussion about trade-offs in distributed data systems, and it did that very well. It wasn’t intended to be a breakthrough formal result, nor was it meant to be a rigorous classification scheme for data systems. 15 years later, we now have a much greater range of tools with different consistency and fault-tolerance models to choose from. CAP has served its purpose, and now it’s time to move on.</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="reference"></a>Reference<a class="hash-link" href="#reference" title="Direct link to heading">#</a></h2><ul><li><a href="https://github.com/henryr/cap-faq" target="_blank" rel="noopener noreferrer">The CAP FAQ</a></li><li><a href="https://medium.com/%E5%BE%8C%E7%AB%AF%E6%96%B0%E6%89%8B%E6%9D%91/cap%E5%AE%9A%E7%90%86101-3fdd10e0b9a" target="_blank" rel="noopener noreferrer">CAP 定理 101—分散式系統，有一好沒兩好</a></li><li><a href="https://martin.kleppmann.com/2015/05/11/please-stop-calling-databases-cp-or-ap.html" target="_blank" rel="noopener noreferrer">Please stop calling databases CP or AP</a></li><li><a href="https://www.researchgate.net/publication/331104869_Consistency_models_of_NoSQL_databases#pf12" target="_blank" rel="noopener noreferrer">Consistency models of NoSQL databases</a></li><li><a href="https://cse.buffalo.edu/~stevko/courses/cse486/spring13/lectures/26-consistency2.pdf" target="_blank" rel="noopener noreferrer">CSE 486/586 Distributed Systems Consistency --- 2</a></li><li><a href="https://www.cs.columbia.edu/~du/ds/assets/lectures/lecture12.pdf" target="_blank" rel="noopener noreferrer">Lec 12: Consistency Models – Sequential, Causal, and Eventual Consistency</a></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/hhow09/hhow09.github.io/blob/source/docs/system/1-cap.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/react/react-vs-vue"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« React v.s. Vue</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/system/distributed-cache"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Distributed Cache »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#intro" class="table-of-contents__link">Intro</a></li><li><a href="#consistency-models" class="table-of-contents__link">Consistency Models</a><ul><li><a href="#taxonomy-of-consistency-model" class="table-of-contents__link">Taxonomy of consistency model.</a></li><li><a href="#trade-offs" class="table-of-contents__link">Trade Offs</a></li><li><a href="#linearizability-c--a" class="table-of-contents__link">Linearizability (<code>C</code> &gt; <code>A</code>)</a></li><li><a href="#sequential-consistency" class="table-of-contents__link">Sequential Consistency</a></li><li><a href="#causal-consistency" class="table-of-contents__link">Causal Consistency</a></li><li><a href="#eventual-consistency-a--c" class="table-of-contents__link">Eventual consistency (<code>A</code> &gt; <code>C</code>)</a></li></ul></li><li><a href="#cpap-a-false-dichotomy" class="table-of-contents__link">CP/AP: a false dichotomy</a></li><li><a href="#reference" class="table-of-contents__link">Reference</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">Docs</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/hhow09" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://www.linkedin.com/in/hhow09" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linkedin</a></li><li class="footer__item"><a href="https://www.cakeresume.com/chihhao-huang-resume" target="_blank" rel="noopener noreferrer" class="footer__link-item">Resume</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 hhow09, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.2339bfd3.js"></script>
<script src="/assets/js/main.fb688673.js"></script>
</body>
</html>